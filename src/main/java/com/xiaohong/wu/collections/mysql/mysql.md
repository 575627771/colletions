## mysql

- 分层
   - server层
      - 连接器
      
             1. 链接器在链接时就是确定这个用户得权限，并且一直使用这个权限，即使中间有修改用户权限，直到下次重新链接；
             2. 可以通过show processlist 查看链接状态，如果为空闲链接，默认时间8小时后会自动断开
             3. 长连接是指链接成功后，客户端持续有请求，则一直使用同一个连接，短连接是查询完就断开，下次查询再重新建立链接
             4. 尽量使用长连接，但是也要注意mysql占用的内存使用率，因为mysql在执行过程中临时使用的内存是管理在链接对象里面的，
             这些资源会在链接释放的时候才释放，所以长连接累计下来，可能导致内存占用太大，被系统强行杀掉---表现为mysql异常重启
                - 定期断开长连接
                - mysql5.7之后可以调用mysql_reset_connection让连接恢复到初始化状态
      - 查询缓存
      
            1. 在执行select语句的时候，执行逻辑会先来到查询缓存，看看是不是执行过这个语句，之前执行过的语句及结果可能会以key-value
            的形式缓存在内存中，key是查询语句，value是结果；
            2. 但是不建议使用查询缓存；8.0版本直接删除了这个模块；
      - 分析器
      
            1. 分析语句，判断sql语句是否满足MySQL语法
      - 优化器
      
            1. 是在表里有多个索引的时候，决定使用那个索引；或者在一个语句有多个表关联（join）的时候,决定各个表的连接顺序。
      - 执行器
      
            1. 执行之前会先判断当前用户对当前表否有执行查询的权限
            2. 如果命中缓存，回再查询缓存之后做权限验证，查询也会在优化器之前调用precheck验证权限；
      - 所有的内置函数
      - 存储过程
      - 触发器
      - 视图
   - 存储引擎层